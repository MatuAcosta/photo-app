import{b as O}from"./chunk-TBOUFQKE.js";import"./chunk-JGAUUDJJ.js";import{a as F,b as M,d as g}from"./chunk-YC7R3RJJ.js";import{Aa as a,Ba as s,Ca as V,D as x,Da as S,Fa as m,Ga as l,Ja as h,M as p,N as v,Na as D,R as c,S as u,Wa as k,cb as I,d as P,e as d,fb as E,ga as w,h as b,na as y,o as _,ra as C,ua as T,wa as U,xa as $}from"./chunk-VR3BEUJN.js";var j=P(M());function R(i,o){if(i&1){let n=S();a(0,"section",2),m("drop",function(t){c(n);let r=l();return u(r.onDrop(t))})("dragover",function(t){c(n);let r=l();return u(r.onDragOver(t))}),a(1,"h3",3),h(2,"Drag and drop image here"),s(),a(3,"input",4),m("change",function(t){c(n);let r=l();return u(r.onFileSelected(t))}),s()()}}function Z(i,o){if(i&1){let n=S();a(0,"section",5),V(1,"img",6),s(),a(2,"section",7)(3,"button",8),m("click",function(){c(n);let t=l();return u(t.removeImage())}),h(4," Remove "),s(),a(5,"button",9),m("click",function(){c(n);let t=l();return u(t.uploadImageToStorage())}),h(6," Upload "),s()()}if(i&2){let n=l();y(1),T("src",n.imageSrc,w)}}var J=(()=>{let o=class o{constructor(){this.pictureService=p(O),this.userService=p(F),this.destroy$=new b,this.router=p(I),this.ngZone=p(C),this.progress=0}ngOnInit(){this.pictureService.uploadProgress$.pipe(x(this.destroy$)).subscribe(e=>d(this,null,function*(){this.progress=e})),this.pictureService.urlPicture$.pipe(x(this.destroy$)).subscribe(e=>d(this,null,function*(){if(e!==""&&this.progress===100){let t=yield _(this.userService.userDTO$);yield this.uploadImageToStore(e,String(t?.username),""),this.navigate("home",1e3)}}))}onDrop(e){if(e.preventDefault(),e.dataTransfer.files.length>1)return alert("Solo puedes subir una imagen");if(!this.verifyFile(e.dataTransfer.files[0]))return alert("Solo puedes subir imagenes");this.imageUploaded=e.dataTransfer.files[0],this.setSrcImage()}setSrcImage(){if(!this.imageUploaded)return alert("No has seleccionado ninguna imagen");this.imageSrc=URL.createObjectURL(this.imageUploaded)}verifyFile(e){return e.type.startsWith("image/")}onDragOver(e){e.preventDefault()}uploadImageToStorage(){return d(this,null,function*(){if(this.imageUploaded)try{let t=`images/${(yield _(this.userService.userDTO$))?.username}/${this.imageUploaded?.name}`;this.pictureService.uploadPictureToStorage(this.imageUploaded,t)}catch{return this.toastify("Error uploading image",!0)}})}uploadImageToStore(e,t,r){return d(this,null,function*(){try{let f=yield this.pictureService.createPicture(e,t,r);if(f.error)throw new Error(f.message);return this.toastify(f.message)}catch{return this.toastify("Error uploading image",!0)}})}removeImage(){this.imageUploaded=void 0,this.imageSrc=void 0}onFileSelected(e){if(e.target.files.length>1)return alert("Solo puedes subir una imagen");if(!this.verifyFile(e.target.files[0]))return alert("Solo puedes subir imagenes");this.imageUploaded=e.target.files[0],this.setSrcImage()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}navigate(e,t){this.ngZone.run(()=>setTimeout(()=>{this.router.navigate([`/${e}`])},t))}toastify(e,t){return(0,j.default)({text:e,duration:3e3,close:!0,gravity:"top",position:"center",stopOnFocus:!0,style:{background:t?`linear-gradient(to right,${g.error[0]},${g.error[1]})`:`linear-gradient(to right, ${g.success[0]}, ${g.success[1]})`},onClick:function(){}}).showToast()}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=v({type:o,selectors:[["app-upload"]],standalone:!0,features:[D],decls:3,vars:1,consts:[[1,"container","w-auto","h-auto","my-24","border-2","border-dashed","border-slate-600"],["class","p-28 flex flex-col items-center justify-center w-full h-full","draggable","true"],["draggable","true",1,"p-28","flex","flex-col","items-center","justify-center","w-full","h-full",3,"drop","dragover"],[1,"text-xl","text-slate-300","font-bold"],["type","file","name","photo","accept","image/*",1,"text-slate-300","font-bold","mt-10",3,"change"],[1,"w-full","h-full","p-5"],[1,"w-full","h-96",3,"src"],[1,"flex","justify-center","my-2","px-5","py-2"],[1,"w-48","mr-4","rounded-full","px-12","text-slate-300","font-bold","bg-slate-950","border-2","border-emerald-600",3,"click"],[1,"w-48","rounded-full","py-2","px-12","text-slate-300","font-bold","bg-slate-950","border-2","border-emerald-600",3,"click"]],template:function(t,r){t&1&&(a(0,"div",0),U(1,R,4,0,"section",1)(2,Z,7,1),s()),t&2&&(y(1),$(1,r.imageUploaded?2:1))},dependencies:[k,E],styles:["input[type=file][_ngcontent-%COMP%]::file-selector-button{background:rgb(2,6,23);border-radius:50px;color:#fff;border:1px solid rgb(16,185,129);padding:5px 10px;margin-right:10px}"]});let i=o;return i})();export{J as UploadComponent};
